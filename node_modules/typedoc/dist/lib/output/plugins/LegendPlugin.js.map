{"version":3,"file":"LegendPlugin.js","sourceRoot":"","sources":["../../../../src/lib/output/plugins/LegendPlugin.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n    Reflection,\n    DeclarationReflection,\n    ProjectReflection,\n} from \"../../models/reflections/index\";\nimport { Component, RendererComponent } from \"../components\";\nimport { PageEvent, RendererEvent } from \"../events\";\n\nexport interface LegendItem {\n    /**\n     * Legend item name\n     */\n    name: string;\n\n    /**\n     * List of css classes that represent the legend item\n     */\n    classes: string[];\n}\n\nconst ignoredClasses = new Set([\"tsd-parent-kind-module\", \"tsd-is-overwrite\"]);\n\nconst completeLegend: LegendItem[][] = [\n    [\n        { name: \"Namespace\", classes: [\"tsd-kind-namespace\"] },\n        { name: \"Object literal\", classes: [\"tsd-kind-object-literal\"] },\n        { name: \"Variable\", classes: [\"tsd-kind-variable\"] },\n        { name: \"Function\", classes: [\"tsd-kind-function\"] },\n        {\n            name: \"Function with type parameter\",\n            classes: [\"tsd-kind-function\", \"tsd-has-type-parameter\"],\n        },\n        { name: \"Index signature\", classes: [\"tsd-kind-index-signature\"] },\n        { name: \"Type alias\", classes: [\"tsd-kind-type-alias\"] },\n        {\n            name: \"Type alias with type parameter\",\n            classes: [\"tsd-kind-type-alias\", \"tsd-has-type-parameter\"],\n        },\n    ],\n    [\n        { name: \"Enumeration\", classes: [\"tsd-kind-enum\"] },\n        { name: \"Enumeration member\", classes: [\"tsd-kind-enum-member\"] },\n        {\n            name: \"Property\",\n            classes: [\"tsd-kind-property\", \"tsd-parent-kind-enum\"],\n        },\n        {\n            name: \"Method\",\n            classes: [\"tsd-kind-method\", \"tsd-parent-kind-enum\"],\n        },\n    ],\n    [\n        { name: \"Interface\", classes: [\"tsd-kind-interface\"] },\n        {\n            name: \"Interface with type parameter\",\n            classes: [\"tsd-kind-interface\", \"tsd-has-type-parameter\"],\n        },\n        {\n            name: \"Constructor\",\n            classes: [\"tsd-kind-constructor\", \"tsd-parent-kind-interface\"],\n        },\n        {\n            name: \"Property\",\n            classes: [\"tsd-kind-property\", \"tsd-parent-kind-interface\"],\n        },\n        {\n            name: \"Method\",\n            classes: [\"tsd-kind-method\", \"tsd-parent-kind-interface\"],\n        },\n        {\n            name: \"Index signature\",\n            classes: [\"tsd-kind-index-signature\", \"tsd-parent-kind-interface\"],\n        },\n    ],\n    [\n        { name: \"Class\", classes: [\"tsd-kind-class\"] },\n        {\n            name: \"Class with type parameter\",\n            classes: [\"tsd-kind-class\", \"tsd-has-type-parameter\"],\n        },\n        {\n            name: \"Constructor\",\n            classes: [\"tsd-kind-constructor\", \"tsd-parent-kind-class\"],\n        },\n        {\n            name: \"Property\",\n            classes: [\"tsd-kind-property\", \"tsd-parent-kind-class\"],\n        },\n        {\n            name: \"Method\",\n            classes: [\"tsd-kind-method\", \"tsd-parent-kind-class\"],\n        },\n        {\n            name: \"Accessor\",\n            classes: [\"tsd-kind-accessor\", \"tsd-parent-kind-class\"],\n        },\n        {\n            name: \"Index signature\",\n            classes: [\"tsd-kind-index-signature\", \"tsd-parent-kind-class\"],\n        },\n    ],\n    [\n        {\n            name: \"Inherited constructor\",\n            classes: [\n                \"tsd-kind-constructor\",\n                \"tsd-parent-kind-class\",\n                \"tsd-is-inherited\",\n            ],\n        },\n        {\n            name: \"Inherited property\",\n            classes: [\n                \"tsd-kind-property\",\n                \"tsd-parent-kind-class\",\n                \"tsd-is-inherited\",\n            ],\n        },\n        {\n            name: \"Inherited method\",\n            classes: [\n                \"tsd-kind-method\",\n                \"tsd-parent-kind-class\",\n                \"tsd-is-inherited\",\n            ],\n        },\n        {\n            name: \"Inherited accessor\",\n            classes: [\n                \"tsd-kind-accessor\",\n                \"tsd-parent-kind-class\",\n                \"tsd-is-inherited\",\n            ],\n        },\n    ],\n    [\n        {\n            name: \"Protected property\",\n            classes: [\n                \"tsd-kind-property\",\n                \"tsd-parent-kind-class\",\n                \"tsd-is-protected\",\n            ],\n        },\n        {\n            name: \"Protected method\",\n            classes: [\n                \"tsd-kind-method\",\n                \"tsd-parent-kind-class\",\n                \"tsd-is-protected\",\n            ],\n        },\n        {\n            name: \"Protected accessor\",\n            classes: [\n                \"tsd-kind-accessor\",\n                \"tsd-parent-kind-class\",\n                \"tsd-is-protected\",\n            ],\n        },\n    ],\n    [\n        {\n            name: \"Private property\",\n            classes: [\n                \"tsd-kind-property\",\n                \"tsd-parent-kind-class\",\n                \"tsd-is-private\",\n            ],\n        },\n        {\n            name: \"Private method\",\n            classes: [\n                \"tsd-kind-method\",\n                \"tsd-parent-kind-class\",\n                \"tsd-is-private\",\n            ],\n        },\n        {\n            name: \"Private accessor\",\n            classes: [\n                \"tsd-kind-accessor\",\n                \"tsd-parent-kind-class\",\n                \"tsd-is-private\",\n            ],\n        },\n    ],\n    [\n        {\n            name: \"Static property\",\n            classes: [\n                \"tsd-kind-property\",\n                \"tsd-parent-kind-class\",\n                \"tsd-is-static\",\n            ],\n        },\n        {\n            name: \"Static method\",\n            classes: [\n                \"tsd-kind-method\",\n                \"tsd-parent-kind-class\",\n                \"tsd-is-static\",\n            ],\n        },\n    ],\n];\n\nexport class LegendBuilder {\n    private _classesList: Set<string>[];\n\n    constructor() {\n        this._classesList = [];\n    }\n\n    build(): LegendItem[][] {\n        const filteredLegend = completeLegend\n            .map((list) => {\n                return list.filter((item) => {\n                    for (const classes of this._classesList) {\n                        if (this.isArrayEqualToSet(item.classes, classes)) {\n                            return true;\n                        }\n                    }\n                    return false;\n                });\n            })\n            .filter((list) => list.length);\n\n        return filteredLegend;\n    }\n\n    registerCssClasses(classArray: string[]) {\n        let exists = false;\n        const items = classArray.filter((cls) => !ignoredClasses.has(cls));\n\n        for (const classes of this._classesList) {\n            if (this.isArrayEqualToSet(items, classes)) {\n                exists = true;\n                break;\n            }\n        }\n\n        if (!exists) {\n            this._classesList.push(new Set(items));\n        }\n    }\n\n    private isArrayEqualToSet<T>(a: T[], b: Set<T>) {\n        if (a.length !== b.size) {\n            return false;\n        }\n\n        for (const value of a) {\n            if (!b.has(value)) {\n                return false;\n            }\n        }\n        return true;\n    }\n}\n\n/**\n * A plugin that generates the legend for the current page.\n *\n * This plugin sets the [[PageEvent.legend]] property.\n */\n@Component({ name: \"legend\" })\nexport class LegendPlugin extends RendererComponent {\n    private _project!: ProjectReflection;\n\n    /**\n     * Create a new LegendPlugin instance.\n     */\n    initialize() {\n        this.listenTo(this.owner, {\n            [RendererEvent.BEGIN]: this.onRenderBegin,\n            [PageEvent.BEGIN]: this.onRendererBeginPage,\n        });\n    }\n\n    private onRenderBegin(event: RendererEvent) {\n        this._project = event.project;\n    }\n\n    /**\n     * Triggered before a document will be rendered.\n     *\n     * @param page  An event object describing the current render operation.\n     */\n    private onRendererBeginPage(page: PageEvent) {\n        const model = page.model;\n        const builder = new LegendBuilder();\n\n        // immediate children\n        this.buildLegend(model, builder);\n\n        // top level items (as appears in navigation)\n        this._project.children?.forEach((reflection) => {\n            if (reflection !== model) {\n                this.buildLegend(reflection, builder);\n            }\n        });\n\n        page.legend = builder.build().sort((a, b) => b.length - a.length);\n    }\n\n    private buildLegend(model: Reflection, builder: LegendBuilder) {\n        if (model instanceof DeclarationReflection) {\n            const children = (\n                model.children || ([] as Array<Reflection | undefined>)\n            )\n                .concat(...(model.groups?.map((group) => group.children) || []))\n                .concat(...model.getAllSignatures())\n                .concat(model.indexSignature as Reflection)\n                .filter((item) => item);\n\n            for (const child of children) {\n                const cssClasses = child?.cssClasses?.split(\" \");\n                if (cssClasses) {\n                    builder.registerCssClasses(cssClasses);\n                }\n            }\n        }\n    }\n}\n"]}