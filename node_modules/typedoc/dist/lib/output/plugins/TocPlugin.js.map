{"version":3,"file":"TocPlugin.js","sourceRoot":"","sources":["../../../../src/lib/output/plugins/TocPlugin.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n    Reflection,\n    ReflectionKind,\n    ProjectReflection,\n    DeclarationReflection,\n    ContainerReflection,\n} from \"../../models/reflections/index\";\nimport { Component, RendererComponent } from \"../components\";\nimport { PageEvent } from \"../events\";\nimport { NavigationItem } from \"../models/NavigationItem\";\n\n/**\n * A plugin that generates a table of contents for the current page.\n *\n * The table of contents will start at the nearest module or dynamic module. This plugin\n * sets the [[PageEvent.toc]] property.\n */\n@Component({ name: \"toc\" })\nexport class TocPlugin extends RendererComponent {\n    /**\n     * Create a new TocPlugin instance.\n     */\n    initialize() {\n        this.listenTo(this.owner, {\n            [PageEvent.BEGIN]: this.onRendererBeginPage,\n        });\n    }\n\n    /**\n     * Triggered before a document will be rendered.\n     *\n     * @param page  An event object describing the current render operation.\n     */\n    private onRendererBeginPage(page: PageEvent) {\n        let model = page.model;\n        if (!(model instanceof Reflection)) {\n            return;\n        }\n\n        const trail: Reflection[] = [];\n        while (\n            !(model instanceof ProjectReflection) &&\n            !model.kindOf(ReflectionKind.SomeModule)\n        ) {\n            trail.unshift(model);\n            model = model.parent;\n        }\n\n        const tocRestriction = this.owner.toc;\n        page.toc = new NavigationItem();\n        TocPlugin.buildToc(model, trail, page.toc, tocRestriction);\n    }\n\n    /**\n     * Create a toc navigation item structure.\n     *\n     * @param model   The models whose children should be written to the toc.\n     * @param trail   Defines the active trail of expanded toc entries.\n     * @param parent  The parent [[NavigationItem]] the toc should be appended to.\n     * @param restriction  The restricted table of contents.\n     */\n    static buildToc(\n        model: Reflection,\n        trail: Reflection[],\n        parent: NavigationItem,\n        restriction?: string[]\n    ) {\n        const index = trail.indexOf(model);\n        const children =\n            (model instanceof ContainerReflection && model.children) || [];\n\n        if (index < trail.length - 1 && children.length > 40) {\n            const child = trail[index + 1];\n            const item = NavigationItem.create(child, parent, true);\n            item.isInPath = true;\n            item.isCurrent = false;\n            TocPlugin.buildToc(child, trail, item);\n        } else {\n            children.forEach((child: DeclarationReflection) => {\n                if (\n                    restriction &&\n                    restriction.length > 0 &&\n                    !restriction.includes(child.name)\n                ) {\n                    return;\n                }\n\n                if (child.kindOf(ReflectionKind.SomeModule)) {\n                    return;\n                }\n\n                const item = NavigationItem.create(child, parent, true);\n                if (trail.includes(child)) {\n                    item.isInPath = true;\n                    item.isCurrent = trail[trail.length - 1] === child;\n                    TocPlugin.buildToc(child, trail, item);\n                }\n            });\n        }\n    }\n}\n"]}